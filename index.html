<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HafH è¨‚æˆ¿æ¯”åƒ¹åŠ©æ‰‹</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                brand: '#7149CE',
                brandHighlight: '#885FE6',
                brandDark: '#342D3E',
                hafhCoin: '#F0E179',
                hafhInfo: '#E363BF',
                hafhDanger: '#F96983',
                hafhSuccess: '#1DBACE',
                textBase: '#1A161F',
                textSub: '#3D3645',
                textSub2: '#5D5665',
                bgBase: '#F6F6F8',
                bgFooter: '#E8E8EC'
              }
            }
          }
        }
    </script>
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F6F6F8; color: #1A161F; -webkit-font-smoothing: antialiased; }
        .card-shadow { box-shadow: 0 4px 20px -2px rgba(52, 45, 62, 0.1); }
        input { -webkit-appearance: none; border-radius: 0.75rem; font-size: 16px !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .fade-enter-active, .fade-leave-active { transition: all 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; transform: translateY(10px); }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="safe-area-inset-bottom">

    <div id="app" v-cloak @click="handleGlobalClick" class="max-w-md mx-auto p-4 md:p-10 pb-24 space-y-8">
        
        <!-- Header -->
        <header class="flex justify-between items-end px-1">
            <div>
                <h1 class="text-2xl font-black text-brand tracking-tight">HafH è¨‚æˆ¿æ¯”åƒ¹åŠ©æ‰‹</h1>
                <p class="text-[11px] text-textSub font-bold tracking-[0.1em]">SMART TRAVEL TOOL</p>
            </div>
            <button @click="resetData" class="text-xs text-textSub font-bold hover:text-hafhDanger transition-colors pb-1">
                æ¸…é™¤è³‡æ–™
            </button>
        </header>

        <!-- [å€å¡Š 1ï¼šæˆæœ¬è¨­å®š] -->
        <section class="bg-white rounded-3xl p-6 card-shadow border border-white">
            <h2 class="text-sm font-bold text-brand mb-4 flex items-center">
                <span class="bg-bgBase p-1.5 rounded-lg mr-2 text-base">âš™ï¸</span> æˆæœ¬è¨­å®š
            </h2>
            <div class="space-y-3">
                <label class="text-[15px] text-textBase font-bold leading-relaxed block">
                    æ¯æš HafH Coins æˆæœ¬
                    <span class="text-textSub block text-[13px] mt-1 font-medium">
                        (é è¨­ 7.05 ç‚º HafH å®˜ç¶²é è¨­æœˆè²»æˆæœ¬ï¼Œ<br>å¦‚æœ‰è‡ªè¡Œè¨˜å¸³å¯è¼¸å…¥å€‹äººåŒ–æˆæœ¬)
                    </span>
                </label>
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-textSub font-bold">$</span>
                    <input type="number" step="0.01" v-model="state.coinUnitCost" 
                        class="w-full border-2 border-bgBase bg-bgBase rounded-xl pl-8 pr-4 py-3 focus:bg-white focus:border-brand focus:outline-none transition-all font-black text-textBase">
                </div>
            </div>
        </section>

        <!-- [å€å¡Š 2ï¼šHafH è³‡è¨Š] -->
        <section class="bg-white rounded-3xl p-6 card-shadow border border-white space-y-5">
            <h2 class="text-sm font-bold text-brand flex items-center">
                <span class="bg-bgBase p-1.5 rounded-lg mr-2 text-base">ğŸ¨</span> HafH è³‡è¨Š
            </h2>
            <div class="space-y-4">
                <div class="space-y-1.5">
                    <label class="text-[13px] text-textSub font-bold ml-1">æ—…å®¿åç¨±</label>
                    <input type="text" v-model="state.hotelName" placeholder="ä¾‹å¦‚ï¼šAce Hotel Kyoto"
                        class="w-full border-2 border-bgBase bg-bgBase rounded-xl px-4 py-3 focus:bg-white focus:border-brand focus:outline-none transition-all font-bold text-brand">
                </div>
                
                <div class="space-y-1.5">
                    <label class="text-[13px] text-textSub font-bold ml-1">å…¥ä½èˆ‡é€€æˆ¿æ—¥æœŸ</label>
                    <div @click.stop="showCalendar = true" 
                         class="w-full border-2 border-bgBase bg-bgBase rounded-xl px-4 py-3 font-bold text-sm cursor-pointer flex justify-between items-center active:scale-[0.98] transition-all">
                        <span :class="state.startDate ? 'text-textBase' : 'text-textSub2'">
                            {{ dateRangeText }}
                        </span>
                        <span class="text-brand">ğŸ“…</span>
                    </div>
                </div>

                <div class="space-y-1.5 pt-2">
                    <label class="text-[13px] text-brand font-bold ml-1 block text-sm">é¡¯ç¤ºä¹‹ HafH Coins</label>
                    <input type="number" v-model="state.displayCoins" placeholder="0"
                        class="w-full border-2 border-[#E8E8EC] bg-[#F6F6F8] rounded-xl px-3 py-3 focus:bg-white focus:border-brand focus:outline-none transition-all font-black text-brand text-center text-xl text-brand">
                    <p class="text-[11px] text-brandHighlight font-bold mt-2 ml-1 p-2 bg-brand/5 rounded-lg leading-relaxed">
                        ğŸ’¡ æé†’ï¼šå¦‚æœ‰ VIP èº«ä»½è«‹ç™»å…¥å¾Œç›´æ¥è¼¸å…¥é¡¯ç¤ºçš„å„ªæƒ åƒ¹æ ¼
                    </p>
                </div>
            </div>
            
            <div class="space-y-4 pt-4 border-t border-dashed border-bgFooter">
                <a :href="googleSearchUrl" target="_blank" rel="noopener noreferrer"
                    class="w-full bg-brand text-white py-4 rounded-2xl font-black hover:bg-brandHighlight transition-all flex items-center justify-center gap-2 text-sm shadow-md active:scale-95 no-underline">
                    ğŸ” å» Google æœå°‹å…¶ä»–ç¶²ç«™è³‡æ–™
                </a>
                
                <div class="bg-bgBase rounded-2xl p-4 border border-slate-100">
                    <div class="flex items-center text-textSub font-bold text-[11px] mb-2">
                        <span class="bg-white px-2 py-0.5 rounded shadow-sm border border-slate-200 mr-2 font-black italic tracking-tighter">ğŸ’¡ æ¯”åƒ¹æé†’</span>
                    </div>
                    <p class="text-[12px] text-textBase font-medium leading-[1.6]">
                        è«‹ç•™æ„æœå°‹çµæœèˆ‡ HafH æä¾›çš„æ¢ä»¶ç›¸ç¬¦æˆ–è¿‘ä¼¼ï¼š<br>
                        1. <span class="text-brand font-bold">å¯å…¥ä½å‰ä¸€æ—¥å…è²»å–æ¶ˆ</span><br>
                        2. <span class="text-brand font-bold">æˆ¿å‹ç‚ºé›™åºŠæˆ–æ˜¯ä¸€å¤§åºŠ</span> ç­‰æ¢ä»¶
                    </p>
                </div>
            </div>
        </section>

        <!-- [å€å¡Š 3ï¼šå¤šä¾†æºæ¯”åƒ¹] -->
        <section class="space-y-4">
            <div class="flex justify-between items-center px-1">
                <h2 class="text-sm font-bold text-brand flex items-center">
                    <span class="bg-white p-1.5 rounded-lg mr-2 text-base shadow-sm">ğŸ’°</span> å…¶ä»–ç¶²ç«™æˆ¿åƒ¹
                </h2>
                <span class="text-[10px] text-textSub font-bold tracking-tight">ğŸ’¡ ä¾†æºåç¨±å¯è‡ªè¡Œæ›´æ”¹</span>
            </div>
            
            <transition-group name="fade" tag="div" class="space-y-4">
                <div v-for="(source, index) in state.cashSources" :key="source.id" 
                     class="bg-white rounded-3xl p-5 card-shadow border-2 transition-all relative"
                     :class="isLowest(source.price) ? 'border-hafhSuccess/40' : 'border-transparent'">
                    
                    <div class="flex justify-between items-center mb-4">
                        <input type="text" v-model="source.name" placeholder="è¼¸å…¥ä¾†æºåç¨±"
                               class="text-sm font-black text-brand bg-bgBase px-3 py-2 rounded-xl border-none focus:ring-2 focus:ring-brand outline-none w-2/3">
                        <button @click="removeSource(index)" class="text-hafhDanger/40 p-2 hover:text-hafhDanger transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>

                    <div class="relative mb-4">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xs text-textSub2 font-black">TWD</span>
                        <input type="number" v-model="source.price" placeholder="è¼¸å…¥ç¸½é¡"
                               class="w-full border-2 border-bgBase bg-bgBase rounded-xl pl-14 pr-4 py-3 font-black text-xl focus:bg-white focus:border-brand outline-none transition-all">
                    </div>

                    <div class="bg-bgBase/50 rounded-2xl p-4 space-y-3">
                        <div class="flex items-center text-[11px] text-textSub font-bold">ğŸ•’ å…è²»å–æ¶ˆæœŸé™ (äºŒæ“‡ä¸€)</div>
                        <div class="grid grid-cols-2 gap-3 items-center">
                            <input type="date" v-model="source.deadlineDate" @input="calcDaysFromDate(index)"
                                   class="text-[11px] bg-white rounded-lg p-3 font-bold border-none outline-none focus:ring-1 focus:ring-brand">
                            <div class="relative">
                                <input type="number" v-model="source.daysBefore" @input="calcDateFromDays(index)"
                                       class="w-full text-[11px] bg-white rounded-lg p-3 pr-8 font-bold border-none outline-none text-center focus:ring-1 focus:ring-brand" placeholder="å¹¾">
                                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-[10px] text-textSub2 font-bold">å¤©å‰</span>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="isLowest(source.price) && source.price > 0" 
                         class="absolute top-0 right-0 bg-hafhSuccess text-white text-[9px] px-3 py-1 font-black rounded-bl-xl shadow-sm tracking-widest">
                        LOWEST
                    </div>
                </div>
            </transition-group>

            <button @click="addSource" 
                    class="w-full py-4 border-2 border-dashed border-brand/30 rounded-3xl text-brand font-black text-sm hover:bg-brand/5 hover:border-brand transition-all flex items-center justify-center gap-2">
                <span>ï¼‹</span> æ–°å¢æ¯”åƒ¹ä¾†æº
            </button>
        </section>

        <!-- [å€å¡Š 4ï¼šè¨ˆç®—çµæœ] -->
        <section v-if="state.displayCoins" class="bg-white rounded-[2.5rem] p-6 card-shadow border border-white space-y-6">
            <div class="grid grid-cols-2 gap-4 text-center">
                <div class="p-4 bg-brand/5 rounded-3xl border border-brand/10">
                    <div class="text-[10px] text-brand font-black mb-0.5 tracking-wider">HafH æˆæœ¬</div>
                    <div class="text-[9px] text-brand font-bold mb-1 opacity-70 italic">å¯å‰ä¸€æ—¥å…è²»å–æ¶ˆ</div>
                    <div class="text-xl font-black text-textBase">${{ hafhTotalCost.toLocaleString() }}</div>
                </div>
                <div class="p-4 bg-bgBase rounded-3xl flex flex-col justify-center text-center">
                    <div class="text-[10px] text-textSub font-bold mb-1 tracking-wider">æœ€ä½åƒ¹ç¶²ç«™</div>
                    <div class="text-xl font-black text-textBase">
                        {{ lowestSource ? '$' + lowestSource.price.toLocaleString() : '---' }}
                    </div>
                </div>
            </div>

            <div :class="isHafhBetter ? 'bg-[#F0FDF4] border-hafhSuccess' : 'bg-[#FFF1F2] border-hafhDanger'"
                 class="rounded-[2.5rem] p-8 border-2 text-center transition-all shadow-inner relative">
                
                <div v-if="isHafhBetter">
                    <div class="text-xs font-bold text-hafhSuccess mb-2 tracking-widest">ä½¿ç”¨ HafH è¨‚æˆ¿çœä¸‹</div>
                    <div class="text-5xl font-black text-hafhSuccess mb-6 tracking-tighter">${{ Math.abs(savings).toLocaleString() }}</div>
                    <div class="bg-hafhSuccess text-white px-8 py-3 rounded-full text-sm font-black shadow-md inline-block leading-relaxed">
                        HafH æ¯”è¼ƒåˆ’ç®— ğŸš€<br>è¶•ç·Šå»é ç´„å¡æˆ¿é–“ï¼
                    </div>
                </div>
                
                <div v-else-if="lowestSource">
                    <div class="text-xs font-bold text-hafhDanger mb-1 tracking-widest text-hafhDanger">
                        åœ¨ {{ lowestSource.name }} è¨‚æˆ¿è¼ƒåˆ’ç®—ï¼Œçœä¸‹
                    </div>
                    <div class="text-5xl font-black text-hafhDanger mb-4 tracking-tighter text-hafhDanger">${{ Math.abs(savings).toLocaleString() }}</div>
                    
                    <div class="space-y-4">
                        <p class="text-[12px] text-hafhDanger font-bold leading-relaxed px-2">
                            è©²ç¶²ç«™å…è²»å–æ¶ˆæœŸé™ç‚ºï¼š<br>
                            <span class="text-base font-black underline decoration-2">
                                {{ lowestSource.deadlineDate || 'æœªå¡«æ—¥æœŸ' }} 
                                {{ lowestSource.daysBefore ? `(${lowestSource.daysBefore} å¤©å‰)` : '' }}
                            </span><br>
                            è«‹ç¢ºèªæ˜¯å¦åƒ HafH ä¸€æ¨£å¯ä»¥å‰ä¸€å¤©å…è²»å–æ¶ˆï¼Œäº«æœ‰æœ€å¤§çš„å½ˆæ€§å®‰æ’ã€‚
                        </p>
                    </div>
                </div>
            </div>

            <div class="bg-[#FFFBEB] border border-hafhCoin rounded-3xl p-6 space-y-4">
                <div class="flex items-center text-[#92400E] font-black text-sm">
                    <span class="mr-2 text-xl">âš ï¸</span> é‡è¦æé†’
                </div>
                <div class="text-[12px] text-[#92400E] space-y-4 font-medium leading-relaxed">
                    <p>
                        <b>HafH è¨‚å–®ï¼š</b><br>
                        é€šå¸¸å¯åœ¨å…¥ä½å‰ä¸€å¤© <span class="text-hafhDanger font-black">23:59 JST (æ—¥æœ¬æ¨™æº–æ™‚é–“)</span> å‰æ–¼ç³»çµ±å…è²»å–æ¶ˆï¼Œç²å¾—å…¨é¡ HafH Coins é€€é‚„ã€‚
                    </p>
                    <p>
                        <b>ä¸€èˆ¬è¨‚æˆ¿ç¶²ç«™ï¼š</b><br>
                        éœ€ç•™æ„ä¸å¯é€€æ¬¾æˆ–éœ€æå‰æ•¸æ—¥å–æ¶ˆä¹‹è¦å®šã€‚<br>
                        è‹¥ç‚ºåœ‹å¤–ç¶²ç«™ï¼Œå³ä¾¿æ¨™è¨»å¯å…è²»å–æ¶ˆï¼Œä»éœ€æ³¨æ„ã€Œ<span class="underline">å–æ¶ˆæ™‚çš„å¹£å€¼åŒ¯å·®</span>ã€ä»¥åŠã€Œ<span class="underline">é‡‘èæ©Ÿæ§‹æµ·å¤–äº¤æ˜“æ‰‹çºŒè²»</span>ã€å¯èƒ½ç„¡æ³•é€€å›ã€‚
                    </p>
                </div>
            </div>
        </section>

        <!-- [æ–°ç‰ˆä½ï¼šæ¨å»£èˆ‡ç¦®é‡] -->
        <section class="space-y-4">
            <!-- AI èª²ç¨‹æ¨å»£ -->
            <div class="bg-gradient-to-br from-brandDark to-brand rounded-[2.5rem] p-7 shadow-xl text-white relative overflow-hidden">
                <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full blur-2xl"></div>
                <div class="relative z-10">
                    <div class="inline-block bg-hafhCoin/20 backdrop-blur-md border border-hafhCoin/30 rounded-lg px-3 py-1 text-[10px] font-bold mb-4 tracking-widest text-hafhCoin">é™æ™‚ 55 æŠ˜å„ªæƒ </div>
                    <h3 class="text-[17px] font-black leading-tight mb-2 tracking-tight">â® AI First è¡Œå‹•åŠ›ï½œå¸¶ä½ é™æœ¬ã€å¢æ•ˆã€å‰µé€ æ–°å•†æ©Ÿ â¯</h3>
                    <p class="text-[12px] opacity-90 mb-6 font-medium">ğŸš€ å¾æ€è€ƒåˆ°è¡Œå‹•ã€å¾è§£é¡Œåˆ°è®Šç¾çš„ AI å•†æ¥­å¯¦æˆ°èª²</p>

                    <div class="space-y-4 mb-8">
                        <div class="flex items-start gap-3">
                            <span class="text-hafhCoin text-lg leading-none">â™Ÿï¸</span>
                            <div class="text-[11px] leading-snug opacity-95">
                                <b class="text-hafhCoin">æœ€å„ªåŒ–æ€ç¶­æ¨¡å‹</b><br>çµåˆæ€ç¶­åˆ¤æ–·ï¼¸AI è¡Œå‹•åŠ›ï¼Œå¸¶ä½ å°‘èµ°å½è·¯ã€æ‹“å±•è¦–é‡
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="text-hafhCoin text-lg leading-none">â™Ÿï¸</span>
                            <div class="text-[11px] leading-snug opacity-95">
                                <b class="text-hafhCoin">å·¥å…·æ•´åˆå¯¦ä½œè§£é¡Œ</b><br>å–„ç”¨ 3A æ€ç¶­æœ‰æ•ˆå°é½Šå•†æ¥­ç›®æ¨™ï¼Œå‘Šåˆ¥ç›²ç›® AI å°å…¥
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="text-hafhCoin text-lg leading-none">â™Ÿï¸</span>
                            <div class="text-[11px] leading-snug opacity-95">
                                <b class="text-hafhCoin">é›¶èƒŒæ™¯å­¸æœƒä¸­æ–‡å¯«ç¨‹å¼</b><br>Vibe Coding æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œè·Ÿç·´å»ºæ§‹ AI æ‡‰ç”¨åŸå‹
                            </div>
                        </div>
                    </div>

                    <div class="bg-white/10 rounded-2xl p-4 border border-white/10 mb-5">
                        <p class="text-[11px] font-bold text-white/80 mb-1 italic">å³æ—¥èµ·è‡³ 2026/2/22 é™æ™‚å„ªæƒ ä½æ–¼ 55 æŠ˜</p>
                        <p class="text-[12px] font-bold text-white">çµå¸³è¼¸å…¥å„ªæƒ ç¢¼ <span class="text-hafhCoin text-base font-black px-1 mx-1 border-b-2 border-hafhCoin">yhaifirst</span> å†æŠ˜ $500ï¼</p>
                    </div>

                    <a href="https://hi.sat.cool/pdyQE" target="_blank" rel="noopener noreferrer" 
                       class="block w-full bg-hafhCoin text-brandDark text-center py-4 rounded-2xl font-black text-sm hover:scale-[1.02] transition-all shadow-lg shadow-black/20 no-underline">
                        äº†è§£æ›´å¤šèª²ç¨‹è©³æƒ… â†’
                    </a>
                </div>
            </div>

            <!-- HafH é‚€è«‹é€£çµ -->
            <div class="bg-white rounded-[2rem] p-6 border-2 border-brand/10 card-shadow flex items-center gap-5">
                <div class="bg-hafhCoin w-14 h-14 rounded-2xl flex items-center justify-center text-2xl shadow-inner">ğŸ</div>
                <div class="flex-1">
                    <h4 class="text-sm font-black text-brand mb-1">ä½¿ç”¨æˆ‘çš„é‚€è«‹é€£çµåŠ å…¥ HafH</h4>
                    <p class="text-[11px] text-textSub font-bold leading-relaxed">
                        å¯ç²å¾—é¡å¤– <span class="text-hafhInfo font-black">100 HafH Coins</span><br>
                        (åƒ¹å€¼ç´„ <span class="text-hafhDanger font-black">NT$800</span>) é‚€è«‹ç¦®é‡
                    </p>
                    <a href="https://www.hafh.com/zh-tw/invite/tw/EDXTKX" target="_blank" class="text-[11px] text-brand font-black underline mt-2 block hover:text-brandHighlight transition-colors">
                        é»æ­¤ç²å–é‚€è«‹ç¦®é‡ â†’
                    </a>
                </div>
            </div>
        </section>

        <!-- [æ—¥æ›†å½ˆçª—] -->
        <transition name="fade">
            <div v-if="showCalendar" class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4">
                <div class="absolute inset-0 bg-brandDark/70 backdrop-blur-md" @click="showCalendar = false"></div>
                <div class="relative bg-white w-full max-w-sm rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[85vh]">
                    <div class="p-5 border-b flex justify-between items-center bg-white sticky top-0 z-20">
                        <h3 class="font-black text-brand">é¸æ“‡æ—¥æœŸç¯„åœ</h3>
                        <button @click="showCalendar = false" class="text-textSub font-bold text-xl p-2">âœ•</button>
                    </div>
                    <div class="overflow-y-auto p-5 space-y-8 bg-white no-scrollbar">
                        <div v-for="month in calendarMonths" :key="month.id">
                            <div class="text-center font-black text-textBase mb-4">{{ month.name }}</div>
                            <div class="grid grid-cols-7 text-center text-[10px] text-textSub font-bold mb-3">
                                <div class="text-hafhDanger">æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div class="text-brand">å…­</div>
                            </div>
                            <div class="grid grid-cols-7 gap-y-2">
                                <div v-for="empty in month.padding" :key="'e'+empty"></div>
                                <div v-for="day in month.days" :key="day.full" 
                                     @click="handleDateClick(day.full)"
                                     class="relative py-3 text-sm font-bold transition-all cursor-pointer flex items-center justify-center"
                                     :class="getDateClass(day.full)">
                                    {{ day.num }}
                                    <div v-if="day.full === state.startDate || day.full === state.endDate" 
                                         class="absolute inset-0 border-2 border-brand rounded-xl z-10 pointer-events-none"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-slate-50 border-t grid grid-cols-2 gap-4">
                        <div class="flex flex-col justify-center">
                            <span class="text-brand font-black text-2xl leading-none">{{ nights }} æ™š</span>
                            <span class="text-[10px] text-textSub font-bold mt-1 tracking-tighter italic text-brandHighlight">é»ç¬¬ 3 æ¬¡å°‡é‡è¨­èµ·æ—¥</span>
                        </div>
                        <button @click="showCalendar = false" class="bg-brand text-white py-4 rounded-2xl font-black text-sm shadow-xl active:scale-95 transition-transform">
                            ç¢ºèªæ—¥æœŸ
                        </button>
                    </div>
                </div>
            </div>
        </transition>

        <footer class="text-center text-textSub text-[11px] font-bold tracking-wide py-10 opacity-60">
            HafH å€‹äººå°å·¥å…· by @yhtu_
        </footer>

    </div>

    <script>
        const { createApp, reactive, computed, watch, onMounted, ref } = Vue;

        createApp({
            setup() {
                const showCalendar = ref(false);
                const initialState = {
                    coinUnitCost: 7.05,
                    hotelName: "",
                    startDate: "",
                    endDate: "",
                    displayCoins: null,
                    cashSources: [
                        { id: 1, name: "å®˜æ–¹ç¶²ç«™", price: null, deadlineDate: "", daysBefore: null },
                        { id: 2, name: "Agoda", price: null, deadlineDate: "", daysBefore: null }
                    ]
                };

                const state = reactive(JSON.parse(JSON.stringify(initialState)));

                onMounted(() => {
                    const saved = localStorage.getItem('hafh_smart_v15');
                    if (saved) Object.assign(state, JSON.parse(saved));
                });

                watch(state, (newVal) => {
                    localStorage.setItem('hafh_smart_v15', JSON.stringify(newVal));
                }, { deep: true });

                const handleGlobalClick = (e) => {
                    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON') {
                        document.activeElement.blur();
                    }
                };

                const addSource = () => {
                    state.cashSources.push({ id: Date.now(), name: "å…¶ä»–ç¶²ç«™", price: null, deadlineDate: "", daysBefore: null });
                };
                const removeSource = (idx) => {
                    if (state.cashSources.length > 1) state.cashSources.splice(idx, 1);
                };

                const calcDateFromDays = (idx) => {
                    if (!state.startDate || state.cashSources[idx].daysBefore === null) return;
                    const d = new Date(state.startDate);
                    d.setDate(d.getDate() - state.cashSources[idx].daysBefore);
                    state.cashSources[idx].deadlineDate = d.toISOString().split('T')[0];
                };
                const calcDaysFromDate = (idx) => {
                    if (!state.startDate || !state.cashSources[idx].deadlineDate) return;
                    const s = new Date(state.startDate);
                    const d = new Date(state.cashSources[idx].deadlineDate);
                    const diff = Math.round((s - d) / (1000 * 60 * 60 * 24));
                    state.cashSources[idx].daysBefore = diff;
                };

                const dateRangeText = computed(() => {
                    if (!state.startDate) return "é¸æ“‡æ—¥æœŸç¯„åœ";
                    if (!state.endDate) return `${state.startDate} â†’ é»é¸é€€æˆ¿`;
                    return `${state.startDate} â†’ ${state.endDate} (${nights.value} æ™š)`;
                });
                const nights = computed(() => {
                    if (!state.startDate || !state.endDate) return 0;
                    const s = new Date(state.startDate); const e = new Date(state.endDate);
                    return Math.max(0, Math.round((e - s) / (1000 * 60 * 60 * 24)));
                });
                const handleDateClick = (dateStr) => {
                    if (!state.startDate || (state.startDate && state.endDate)) {
                        state.startDate = dateStr; state.endDate = "";
                    } else {
                        const s = new Date(state.startDate); const n = new Date(dateStr);
                        if (n > s) state.endDate = dateStr; else { state.startDate = dateStr; state.endDate = ""; }
                    }
                };
                const getDateClass = (dateStr) => {
                    if (dateStr === state.startDate || dateStr === state.endDate) return 'bg-brand text-white rounded-xl shadow-lg';
                    if (state.startDate && state.endDate && dateStr > state.startDate && dateStr < state.endDate) return 'bg-brand/10 text-brand';
                    return 'text-textBase hover:bg-bgBase';
                };
                const calendarMonths = computed(() => {
                    const months = []; const now = new Date();
                    for (let i = 0; i < 8; i++) {
                        const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
                        const daysInMonth = new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
                        const days = [];
                        for (let j = 1; j <= daysInMonth; j++) {
                            days.push({ num: j, full: `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(j).padStart(2, '0')}` });
                        }
                        months.push({ id: i, name: `${d.getFullYear()}å¹´ ${d.getMonth() + 1}æœˆ`, padding: d.getDay(), days });
                    }
                    return months;
                });

                const lowestSource = computed(() => {
                    const valid = state.cashSources.filter(s => s.price > 0);
                    return valid.length ? valid.reduce((a, b) => a.price < b.price ? a : b) : null;
                });
                const isLowest = (p) => p > 0 && p === lowestSource.value?.price;
                const hafhTotalCost = computed(() => Math.round((state.displayCoins || 0) * state.coinUnitCost));
                const savings = computed(() => (lowestSource.value?.price || 0) - hafhTotalCost.value);
                const isHafhBetter = computed(() => savings.value > 0);

                const googleSearchUrl = computed(() => {
                    const q = encodeURIComponent(`${state.hotelName} ${state.startDate || ""} è¨‚æˆ¿`);
                    return `https://www.google.com/search?q=${q}`;
                });

                const resetData = () => {
                    if(confirm("ç¢ºå®šè¦é‡ç½®è³‡æ–™å—ï¼Ÿ")) {
                        Object.assign(state, JSON.parse(JSON.stringify(initialState)));
                        localStorage.removeItem('hafh_smart_v15');
                    }
                };

                return {
                    state, showCalendar, calendarMonths, dateRangeText, nights,
                    handleDateClick, getDateClass, lowestSource, hafhTotalCost,
                    savings, isHafhBetter, googleSearchUrl, isLowest, resetData,
                    handleGlobalClick, calcDateFromDays, calcDaysFromDate, addSource, removeSource
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
    
  </body>
  
</html>
